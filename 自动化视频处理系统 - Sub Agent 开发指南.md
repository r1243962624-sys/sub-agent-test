
# 自动化视频内容处理系统 - Sub Agent 开发指南

---

## 项目概述

本项目旨在构建一套**自动化视频内容处理流程**，实现从视频链接输入到结构化笔记输出的端到端自动化。

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  视频链接   │ -> │  视频下载   │ -> │  ASR转写    │ -> │  LLM整理    │ -> 📝 结构化笔记
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

---

## 第一阶段：需求分析与规划

### Step 1：启动项目，唤起产品经理

**操作指令：**
```
我要开发一个自动化视频内容处理系统，请帮我进行需求分析。

核心需求：
1. 输入：网页视频链接（支持 YouTube、B站等平台）
2. 处理流程：视频下载 → ASR语音转文字 → 大模型生成笔记
3. 输出：Markdown格式的结构化笔记（知识点、SOP等）

技术要求：
- 本地部署优先，使用 Whisper 做 ASR
- 支持 M3U8 加密流处理
- 提示词模板可配置、可复用
- 预留人工补充截图的能力

/PRD
```

**预期产出：** `PRD.md` 文档，包含：
- 功能模块定义（下载模块、ASR模块、LLM模块、输出模块）
- 用户故事与使用场景
- MVP 功能范围
- 非功能需求（本地部署、性能要求）

---

### Step 2：确认 PRD 后，进入设计阶段

**操作指令：**
```
PRD 已确认。这个系统主要是后端处理流程，但需要一个简洁的操作界面。

设计需求：
- 简洁的单页应用
- 主要操作：粘贴链接、查看进度、预览/导出笔记
- 技术风格，深色主题
- 需要展示处理状态（下载中、转写中、生成中、完成）

/设计
```

**预期产出：** 设计策略确认后生成 `designspec.md`

---

## 第二阶段：技术架构设计

### Step 3：唤起大模型应用工程师设计 AI 方案

**操作指令：**
```
请根据 PRD 设计 AI 功能方案。

重点关注：
1. ASR 方案：Whisper 本地部署 vs 讯飞在线 API 的选型对比
2. 笔记生成：使用什么模型？Prompt 如何设计？
3. 提示词管理：如何实现模板化、可配置？
4. 后续扩展：OCR、多模态理解的预留接口

/AI
```

**预期产出：**
- ASR 方案对比与推荐
- LLM 选型建议（Claude/GPT-4 等）
- Prompt 模板框架设计
- 成本估算

---

### Step 4：唤起后端工程师设计系统架构

**操作指令：**
```
请根据 PRD 和 AI 方案设计后端架构。

技术要求：
- Python 技术栈优先（FastAPI）
- 视频下载需支持多平台（yt-dlp）
- ASR 使用 Whisper 本地部署
- 任务队列处理长时间任务
- 提供 RESTful API 供前端调用

/后端
```

**预期产出：**
- 系统架构设计
- API 接口清单
- 数据库设计（任务表、模板表）
- 部署方案

---

### Step 5：唤起前端工程师设计前端架构

**操作指令：**
```
请根据 PRD 和 designspec.md 设计前端架构。

技术要求：
- React + TypeScript
- 简洁的单页应用
- 实时显示任务状态
- Markdown 预览与导出功能

/开发
```

**预期产出：**
- 前端技术方案
- 组件清单
- 页面结构

---

## 第三阶段：代码开发

### Step 6：后端核心模块开发

**开发顺序与指令：**

#### 6.1 视频下载模块
```
请开发视频下载模块。

要求：
- 使用 yt-dlp 库
- 支持 YouTube、B站、通用 M3U8
- 下载后提取音频（mp3/wav）
- 返回文件路径供后续处理

/后端
```

#### 6.2 ASR 转写模块
```
请开发 ASR 转写模块。

要求：
- 集成 OpenAI Whisper（本地）
- 支持选择模型大小（tiny/base/small/medium/large）
- 输出带时间戳的转录文本
- 支持中英文自动识别

/后端
```

#### 6.3 任务调度模块
```
请开发异步任务调度模块。

要求：
- 使用 Celery + Redis
- 任务状态追踪（pending/downloading/transcribing/generating/done/failed）
- 支持任务取消
- WebSocket 推送状态更新

/后端
```

---

### Step 7：AI 功能模块开发

**开发顺序与指令：**

#### 7.1 Prompt 模板管理
```
请开发 Prompt 模板管理模块。

要求：
- 支持 CRUD 操作
- 预置"Bro框架"笔记整理模板
- 模板支持变量插值（如 {{transcript}}）
- 导入/导出模板功能

/AI
```

#### 7.2 笔记生成模块
```
请开发 LLM 笔记生成模块。

要求：
- 支持 Claude API / OpenAI API
- 将转录文本与 Prompt 模板组合
- 流式输出支持
- Token 使用量统计
- 错误重试机制

输出格式要求：
- Markdown 格式
- 包含：摘要、知识点、SOP、关键引用

/AI
```

#### 7.3 预置 Prompt 模板
```
请为视频笔记整理场景设计一套完整的 Prompt 模板。

要求：
- System Prompt：定义角色和输出规范
- 输出结构：
  1. 视频摘要（3-5句话）
  2. 核心知识点（层级结构）
  3. 操作步骤/SOP（如有）
  4. 金句/关键引用
  5. 延伸思考/行动建议
- 适配不同视频类型（知识类、教程类、访谈类）

/AI
```

---

### Step 8：前端开发

**开发顺序与指令：**

#### 8.1 基础架构搭建
```
请搭建前端项目基础架构。

要求：
- Vite + React + TypeScript
- Tailwind CSS
- 目录结构规划
- API 请求封装
- 全局状态管理（Zustand）

/开发
```

#### 8.2 核心页面开发
```
请开发主页面。

功能：
1. 链接输入区：粘贴视频链接，选择 Prompt 模板
2. 任务列表：显示历史任务和当前状态
3. 进度展示：下载进度、转写进度、生成状态
4. 结果预览：Markdown 渲染展示
5. 操作按钮：复制、导出、重新生成

/开发
```

#### 8.3 Markdown 编辑器组件
```
请开发 Markdown 预览与编辑组件。

要求：
- 支持实时预览
- 支持手动插入图片（截图补充）
- 导出为 .md 文件
- 复制到剪贴板

/开发
```

---

## 第四阶段：集成与测试

### Step 9：端到端集成

**操作指令：**
```
请帮我完成前后端集成。

检查清单：
1. API 接口联调
2. WebSocket 状态推送
3. 错误处理与用户提示
4. 完整流程测试（输入链接 → 输出笔记）

/开发
```

---

## 第五阶段：Sub Agent 封装（可选进阶）

### Step 10：封装为可复用 Tool

当核心功能稳定后，可将关键模块封装为 Sub Agent 系统中的 Tool：

**操作指令：**
```
请帮我将视频处理流程封装为 Sub Agent 可调用的 Tool。

需要封装的 Tool：
1. video_downloader：输入 URL，输出音频文件路径
2. audio_transcriber：输入音频路径，输出转录文本
3. note_generator：输入转录文本+模板，输出结构化笔记

Tool 规范：
- 明确的输入/输出 Schema
- 错误码定义
- 使用示例

/AI
```

---

## 附录：关键文件清单

| 文件 | 说明 | 生成阶段 |
|------|------|---------|
| `PRD.md` | 产品需求文档 | 阶段一 |
| `designspec.md` | 设计规范文档 | 阶段一 |
| `api-spec.yaml` | API 接口文档 | 阶段二 |
| `prompts/video-note.md` | 视频笔记 Prompt 模板 | 阶段三 |

---

## 快速参考：Agent 调用顺序

```
┌──────────────────────────────────────────────────────────────────┐
│                        开发流程总览                               │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  🔴 产品经理 ──────> 需求分析 & PRD                               │
│       │                                                          │
│       ▼                                                          │
│  🔵 设计师 ────────> 设计策略 & 设计规范                          │
│       │                                                          │
│       ▼                                                          │
│  🟣 LLM工程师 ─────> AI方案设计 & Prompt模板                      │
│       │                                                          │
│       ▼                                                          │
│  🟡 后端工程师 ────> 架构设计 & API开发 & 核心模块                │
│       │                                                          │
│       ▼                                                          │
│  🟣 LLM工程师 ─────> AI功能代码实现                               │
│       │                                                          │
│       ▼                                                          │
│  🟢 前端工程师 ────> 前端开发 & 集成联调                          │
│       │                                                          │
│       ▼                                                          │
│  🟣 LLM工程师 ─────> 封装为 Sub Agent Tool（可选）                │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

---

## 注意事项

### ⚠️ 当前限制与人工环节
1. **截图补充**：系统暂不支持自动捕获视频画面，需手动截图插入
2. **视觉信息**：鼠标操作、界面演示等内容需人工记录
3. **平台适配**：部分平台可能需要额外处理（Cookie、登录态）

### 🔮 后续优化方向
1. 集成 OCR 提取视频中的文字
2. 引入多模态模型理解视频画面
3. 自动关键帧提取与截图
4. 支持更多视频平台
